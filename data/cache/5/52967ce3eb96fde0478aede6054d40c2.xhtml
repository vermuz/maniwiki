
<h1 class="sectionedit1" id="drupal_menu_system">Drupal Menu System</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Drupal Menu System" [1-34] -->
<h2 class="sectionedit2" id="menu_magiccontextinc">menu_magic.context.inc</h2>
<div class="level2">
<pre class="code">&lt;?php

function menu_magic_node_context($node) {
  $text = _menu_magicify($node-&gt;body[&#039;und&#039;][0][&#039;value&#039;]);
  $output = array(
    &#039;#type&#039; =&gt; &#039;markup&#039;,
    &#039;#markup&#039; =&gt; $text,
  );
  return $output;
}

/**
 * Helper function.
 */
function _menu_magicify($text) {
  $substitutions = array (
    &#039; &#039; =&gt; &#039; &#039;,
    &#039;!&#039; =&gt; &quot;¡&quot;,          # ¡
    &#039;&quot;&#039; =&gt; &quot;„&quot;,          # „
    &#039;#&#039; =&gt; &#039;#&#039;,
    &#039;$&#039; =&gt; &#039;$&#039;,
    &#039;%&#039; =&gt; &#039;%&#039;,
    &#039;&amp;&#039; =&gt; &quot;⅋&quot;,          # ⅋
    &quot;&#039;&quot; =&gt; &quot;͵&quot;,           # ͵
    &#039;(&#039; =&gt; &#039;)&#039;,
    &#039;)&#039; =&gt; &#039;(&#039;,
    &#039;*&#039; =&gt; &#039;*&#039;,
    &#039;+&#039; =&gt; &#039;+&#039;,
    &#039;,&#039; =&gt; &quot;‘&quot;,          # ‘
    &#039;-&#039; =&gt; &#039;-&#039;,
    &#039;.&#039; =&gt; &quot;˙&quot;,          # ˙
    &#039;/&#039; =&gt; &#039;/&#039;,
    &#039;0&#039; =&gt; &#039;0&#039;,
    &#039;1&#039; =&gt; &quot;⃓&quot;,           # ,⃓ can be improved
    &#039;2&#039; =&gt; &quot;ჷ&quot;,          # ჷ
    &#039;3&#039; =&gt; &quot;ε&quot;,          # ε
    &#039;4&#039; =&gt; &quot;⇁⃓&quot;,         # ⇁⃓ can be improved
    &#039;5&#039; =&gt; &quot;ᔕ&quot;,          # ᔕ or maybe just &quot;S&quot;
    &#039;6&#039; =&gt; &#039;9&#039;,
    &#039;7&#039; =&gt; &quot;_̸&quot;,          # _̸
    &#039;8&#039; =&gt; &#039;8&#039;,
    &#039;9&#039; =&gt; &#039;6&#039;,
    &#039;:&#039; =&gt; &#039;:&#039;,
    &#039;;&#039; =&gt; &quot;⋅̕&quot;,           # ⋅̕ sloppy, should be improved
    &#039;&lt;&#039; =&gt; &#039;&gt;&#039;,
    &#039;=&#039; =&gt; &#039;=&#039;,
    &#039;&gt;&#039; =&gt; &#039;&lt;&#039;,
    &#039;?&#039; =&gt; &quot;¿&quot;,          # ¿
    &#039;@&#039; =&gt; &#039;@&#039;,          # can be improved
    &#039;A&#039; =&gt; &quot;Ꮜ&quot;,          # Ꮜ
    &#039;B&#039; =&gt; &quot;ϴ&quot;,          # ϴ can be improved
    &#039;C&#039; =&gt; &quot;Ɔ&quot;,          # Ɔ
    &#039;D&#039; =&gt; &#039;p&#039;,          # should be an uppercase D!!
    &#039;E&#039; =&gt; &quot;Ǝ&quot;,          # Ǝ
    &#039;F&#039; =&gt; &quot;Ⅎ&quot;,          # Ⅎ
    &#039;G&#039; =&gt; &quot;⅁&quot;,          # ⅁
    &#039;H&#039; =&gt; &#039;H&#039;,
    &#039;I&#039; =&gt; &#039;I&#039;,
    &#039;J&#039; =&gt; &quot;ſ&quot;,          # ſ̲
    &#039;K&#039; =&gt; &quot;ʞ&quot;,          # ʞ should be an uppercase K!!
    &#039;L&#039; =&gt; &quot;⅂&quot;,          # ⅂
    &#039;M&#039; =&gt; &quot;Ɯ&quot;,          # Ɯ or maybe just &quot;W&quot;
    &#039;N&#039; =&gt; &#039;N&#039;,
    &#039;O&#039; =&gt; &#039;O&#039;,
    &#039;P&#039; =&gt; &#039;d&#039;,          # should be uppercase P
    &#039;Q&#039; =&gt; &quot;Ծ&quot;,          # Ծ can be improved
    &#039;R&#039; =&gt; &quot;Ȣ&quot;,          # Ȣ can be improved
    &#039;S&#039; =&gt; &#039;S&#039;,
    &#039;T&#039; =&gt; &quot;⊥&quot;,          # ⊥
    &#039;U&#039; =&gt; &quot;ᑎ&quot;,          # ᑎ
    &#039;V&#039; =&gt; &quot;Λ&quot;,          # Λ
    &#039;W&#039; =&gt; &#039;M&#039;,
    &#039;X&#039; =&gt; &#039;X&#039;,
    &#039;Y&#039; =&gt; &quot;⅄&quot;,          # ⅄
    &#039;Z&#039; =&gt; &#039;Z&#039;,
    &#039;[&#039; =&gt; &#039;]&#039;,
    &#039;\\&#039; =&gt; &#039;\\&#039;,
    &#039;]&#039; =&gt; &#039;[&#039;,
    &#039;^&#039; =&gt; &quot;‿&quot;,          # ‿
    &#039;_&#039; =&gt; &quot;‾&quot;,          # ‾
    &#039;`&#039; =&gt; &quot; ̖&quot;,          #  ̖
    &#039;a&#039; =&gt; &quot;ɐ&quot;,          # ɐ
    &#039;b&#039; =&gt; &#039;q&#039;,
    &#039;c&#039; =&gt; &quot;ɔ&quot;,          # ɔ
    &#039;d&#039; =&gt; &#039;p&#039;,
    &#039;e&#039; =&gt; &quot;ǝ&quot;,          # ǝ
    &#039;f&#039; =&gt; &quot;ɟ&quot;,          # ɟ
    &#039;g&#039; =&gt; &quot;ɓ&quot;,          # ɓ
    &#039;h&#039; =&gt; &quot;ɥ&quot;,          # ɥ
    &#039;i&#039; =&gt; &quot;ı̣&quot;,          # ı̣
    &#039;j&#039; =&gt; &quot;ſ&quot;,         # ſ̣
    &#039;k&#039; =&gt; &quot;ʞ&quot;,          # ʞ
    &#039;l&#039; =&gt; &quot;Ʈ&quot;,          # Ʈ can be improved
    &#039;m&#039; =&gt; &quot;ɯ&quot;,          # ɯ
    &#039;n&#039; =&gt; &#039;u&#039;,
    &#039;o&#039; =&gt; &#039;o&#039;,
    &#039;p&#039; =&gt; &#039;d&#039;,
    &#039;q&#039; =&gt; &#039;b&#039;,
    &#039;r&#039; =&gt; &quot;ɹ&quot;,          # ɹ
    &#039;s&#039; =&gt; &#039;s&#039;,
    &#039;t&#039; =&gt; &quot;ʇ&quot;,          # ʇ
    &#039;u&#039; =&gt; &#039;n&#039;,
    &#039;v&#039; =&gt; &quot;ʌ&quot;,          # ʌ
    &#039;w&#039; =&gt; &quot;ʍ&quot;,          # ʍ
    &#039;x&#039; =&gt; &#039;x&#039;,
    &#039;y&#039; =&gt; &quot;ʎ&quot;,          # ʎ
    &#039;z&#039; =&gt; &#039;z&#039;,
    &#039;{&#039; =&gt; &#039;}&#039;,
    &#039;|&#039; =&gt; &#039;|&#039;,
    &#039;}&#039; =&gt; &#039;{&#039;,
    &#039;~&#039; =&gt; &quot;∼&quot;,          # ∼
  );
  $find = array_keys($substitutions);
  $replace = array_values($substitutions);

  return str_replace($find, $replace, $text);
}</pre>

</div>
<!-- EDIT2 SECTION "menu_magic.context.inc" [35-3124] -->
<h2 class="sectionedit3" id="menu_magiccss">menu_magic.css</h2>
<div class="level2">
<pre class="code">div.menu-magic-image img {
  border: 4px solid #F00;
}
</pre>

</div>
<!-- EDIT3 SECTION "menu_magic.css" [3125-3222] -->
<h2 class="sectionedit4" id="menu_magicextrainc">menu_magic.extra.inc</h2>
<div class="level2">
<pre class="code">&lt;?php

function menu_magic_extra($wildcard) {
  $content = array(
    &#039;#type&#039; =&gt; &#039;markup&#039;,
    &#039;#markup&#039; =&gt; &#039;&lt;p&gt;&#039;. t(&#039;The wildcard contains the value &quot;%wildcard&quot;.&#039;, array(&#039;%wildcard&#039; =&gt; $wildcard)) . &#039;&lt;/p&gt;&#039;,
  );
  return $content;
}</pre>

</div>
<!-- EDIT4 SECTION "menu_magic.extra.inc" [3223-3504] -->
<h2 class="sectionedit5" id="menu_magicinfo">menu_magic.info</h2>
<div class="level2">
<pre class="code">name = Menu Magic
description = Demonstrate the use of hook_menu.
core = 7.x
</pre>

</div>
<!-- EDIT5 SECTION "menu_magic.info" [3505-3625] -->
<h2 class="sectionedit6" id="menu_magicmodule">menu_magic.module</h2>
<div class="level2">
<pre class="code">&lt;?php

/**
 * Implements hook_menu().
 */
function menu_magic_menu() {
  $items = array();

  $items[&#039;magic&#039;] = array(
    &#039;title&#039; =&gt; &#039;A little magic&#039;,
    &#039;page callback&#039; =&gt; &#039;menu_magic_basic&#039;,
    &#039;access arguments&#039; =&gt; array(&#039;access content&#039;),
  );

  $items[&#039;magic/%&#039;] = array(
    &#039;title&#039; =&gt; &#039;Even more magical&#039;,
    &#039;page callback&#039; =&gt; &#039;menu_magic_extra&#039;,
    &#039;page arguments&#039; =&gt; array(1),
    &#039;access arguments&#039; =&gt; array(&#039;access content&#039;),
    &#039;file&#039; =&gt; &#039;menu_magic.extra.inc&#039;,
  );

  $items[&#039;user/%/magic&#039;] = array(
    &#039;title&#039; =&gt; &#039;Magic&#039;,
    &#039;description&#039; =&gt; &#039;Magical magic for users&#039;,
    &#039;page callback&#039; =&gt; &#039;menu_magic_user_tab&#039;,
    &#039;page arguments&#039; =&gt; array(1),
    &#039;access callback&#039; =&gt; &#039;user_access&#039;,
    &#039;access arguments&#039; =&gt; array(&#039;administer users&#039;),
    &#039;file&#039; =&gt; &#039;menu_magic.user.inc&#039;,
    &#039;type&#039; =&gt; MENU_LOCAL_TASK,
  );

  // node_load(%)
  $items[&#039;node/%node/magic&#039;] = array(
    &#039;title&#039; =&gt; &#039;Magic&#039;,
    &#039;description&#039; =&gt; &#039;Do amazing and magical things&#039;,
    &#039;page callback&#039; =&gt; &#039;menu_magic_node_context&#039;,
    &#039;page arguments&#039; =&gt; array(1),
    &#039;access arguments&#039; =&gt; array(&#039;access content&#039;),
    &#039;file&#039; =&gt; &#039;menu_magic.context.inc&#039;,
    &#039;type&#039; =&gt; MENU_LOCAL_TASK,
    &#039;context&#039; =&gt; MENU_CONTEXT_PAGE | MENU_CONTEXT_INLINE,
  );

  return $items;
}

function menu_magic_basic() {
  $content = array();

  // This is a very, very simple page element. It will appear on the page,
  // but other modules can&#039;t customize it and themes can&#039;t override its markup.
  $content[&#039;raw_markup&#039;] = array(
    &#039;#type&#039; =&gt; &#039;markup&#039;,
    &#039;#markup&#039; =&gt; &#039;Truly, this is magical!&#039;,
    &#039;#prefix&#039; =&gt; &#039;&lt;p&gt;&#039;,
    &#039;#suffix&#039; =&gt; &#039;&lt;/p&gt;&#039;,
  );

  $variables = array(
    &#039;path&#039; =&gt; &#039;http://placekitten.com/440/400&#039;,
    &#039;alt&#039; =&gt; t(&#039;This is a magical kitten&#039;),
    &#039;title&#039; =&gt; t(&#039;This is the title&#039;),
  );
  $content[&#039;themed_data&#039;] = array(
    &#039;#type&#039; =&gt; &#039;markup&#039;,
    &#039;#markup&#039; =&gt; theme(&#039;image&#039;, $variables),
    &#039;#prefix&#039; =&gt; &#039;&lt;div class=&quot;menu-magic-image&quot;&gt;&#039;,
    &#039;#suffix&#039; =&gt; &#039;&lt;/div&gt;&#039;,
    &#039;#attached&#039; =&gt; array(
      &#039;css&#039; =&gt; array(
        drupal_get_path(&#039;module&#039;, &#039;menu_magic&#039;) . &#039;/menu_magic.css&#039;,
      ),
    ),
  );

  $content[&#039;renderable_element&#039;] = array(
    &#039;#theme&#039; =&gt; &#039;item_list&#039;,
    &#039;#title&#039; =&gt; t(&#039;How do we know it\&#039;s magic?&#039;),
    &#039;#items&#039; =&gt; array(
      t(&quot;Is it made of wood?&quot;),
      t(&quot;Does it sink in water?&quot;),
      t(&quot;Does it weigh the same as a duck?&quot;),
      t(&#039;The current time is %time.&#039;, array(&#039;%time&#039; =&gt; date(&#039;r&#039;))),
    ),
    &#039;#cache&#039; =&gt; array(
      &#039;keys&#039; =&gt; array(&#039;menu_magic&#039;, &#039;renderable_element&#039;), // menu_magic:renderable_element
      &#039;bin&#039; =&gt; &#039;cache&#039;,
      &#039;expire&#039; =&gt; time() + 30,
      &#039;granularity&#039; =&gt; DRUPAL_CACHE_PER_PAGE,
    ),
  );

  return $content;
}</pre>

</div>
<!-- EDIT6 SECTION "menu_magic.module" [3626-6364] -->
<h2 class="sectionedit7" id="menu_magicuserinc">menu_magic.user.inc</h2>
<div class="level2">
<pre class="code">&lt;?php

/**
 * Page callback for the &#039;user/%/magic tab.
 */
function menu_magic_user_tab($wildcard) {
  if (is_numeric($wildcard) &amp;&amp; ($account = user_load($wildcard))) {
    return array(
      &#039;#type&#039;   =&gt; &#039;markup&#039;,
      &#039;#markup&#039; =&gt; t(&quot;%username is totally awesome.&quot;, array(&#039;%username&#039; =&gt; $account-&gt;name)),
    );
  }
  else {
    return drupal_not_found();
  }
}</pre>

</div>
<!-- EDIT7 SECTION "menu_magic.user.inc" [6365-] -->